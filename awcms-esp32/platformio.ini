; AWCMS ESP32 IoT Firmware
; PlatformIO Configuration

[env:esp32dev]
platform = espressif32
board = esp32dev
framework = arduino
monitor_speed = 115200
upload_speed = 921600

; Filesystem
board_build.filesystem = spiffs
board_build.partitions = default.csv

; Libraries
lib_deps = 
    ESP Async WebServer
    AsyncTCP
    ArduinoJson@^7.0.0
    https://github.com/jhagas/ESPSupabase.git
    WiFi

; Build flags - Inject secrets from environment
build_flags = 
    -DCORE_DEBUG_LEVEL=3
    -DASYNCWEBSERVER_REGEX
    ; WiFi credentials from .env
    '-D WIFI_SSID="${sysenv.WIFI_SSID}"'
    '-D WIFI_PASSWORD="${sysenv.WIFI_PASSWORD}"'
    ; Supabase credentials from .env
    '-D SUPABASE_URL="${sysenv.SUPABASE_URL}"'
    '-D SUPABASE_ANON_KEY="${sysenv.SUPABASE_ANON_KEY}"'
    ; Device config from .env
    '-D DEVICE_ID="${sysenv.DEVICE_ID}"'
    '-D DEVICE_NAME="${sysenv.DEVICE_NAME}"'
    '-D TENANT_ID="${sysenv.TENANT_ID}"'
    ; Auth from .env
    '-D AUTH_USERNAME="${sysenv.AUTH_USERNAME}"'
    '-D AUTH_PASSWORD="${sysenv.AUTH_PASSWORD}"'

; ESP32-CAM specific environment
[env:esp32cam]
platform = espressif32
board = esp32cam
framework = arduino
monitor_speed = 115200
upload_speed = 460800
board_build.filesystem = spiffs
lib_deps = ${env:esp32dev.lib_deps}
build_flags = 
    ${env:esp32dev.build_flags}
    -D ENABLE_CAMERA

; Extra scripts
extra_scripts = pre:scripts/build_web.py
