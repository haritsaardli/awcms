---
/**
 * ThemeLoader.astro - Loads dynamic theme CSS from Supabase.
 *
 * Place in Layout.astro head to inject theme CSS variables.
 */
import { createClientFromEnv } from "~/lib/supabase";
import { getActiveTheme, generateCssVariables } from "~/lib/theme";

// Get tenant from locals (set by middleware)
const tenant_id = Astro.locals.tenant_id || null;

// Create Supabase client
const supabase = createClientFromEnv(
    Astro.locals.runtime?.env || import.meta.env,
);

let themeCss = "";

if (supabase) {
    try {
        const theme = await getActiveTheme(supabase, tenant_id);
        if (theme) {
            themeCss = generateCssVariables(theme);
        }
    } catch (error) {
        console.error("[ThemeLoader] Error loading theme:", error);
    }
}
---

{themeCss && <style set:html={themeCss} />}
