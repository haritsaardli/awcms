---
import Layout from "../../layouts/Layout.astro";
import { Icon } from "astro-icon/components";
import {
  getLocale,
  t,
  getLocalizedValue,
  getLocalizedPath,
  type Locale,
} from "../../utils/i18n";
import { getServicesPageData, getImagesData } from "../../lib/api";

const locale = getLocale(Astro.url) as Locale;
const servicesData = await getServicesPageData();
const imagesData = await getImagesData();
const { library } = servicesData;
---

<Layout title={getLocalizedValue(library.title, locale)}>
  <!-- Hero -->
  <section
    class="hero-gradient text-white py-16 md:py-20"
    data-testid="library-hero"
  >
    <div class="container-custom">
      <nav class="text-sm text-blue-200 mb-4">
        <a href={getLocalizedPath("/", locale)} class="hover:text-white"
          >Beranda</a
        >
        <span class="mx-2">/</span>
        <a href={getLocalizedPath("/layanan", locale)} class="hover:text-white"
          >{t("services.title", locale)}</a
        >
        <span class="mx-2">/</span>
        <span class="text-white">{t("services.library", locale)}</span>
      </nav>
      <h1 class="text-3xl md:text-4xl font-bold font-heading">
        {getLocalizedValue(library.title, locale)}
      </h1>
    </div>
  </section>

  <!-- Library Content -->
  <section class="py-16 bg-gray-50" data-testid="library-content">
    <div class="container-custom">
      <div class="grid lg:grid-cols-2 gap-12 items-start">
        <!-- Image Gallery -->
        <div class="space-y-4">
          <div class="aspect-video rounded-2xl overflow-hidden shadow-lg">
            <img
              src={imagesData.library[0]}
              alt="Perpustakaan SMAN 2 Pangkalan Bun"
              class="w-full h-full object-cover"
            />
          </div>
          <div class="grid grid-cols-3 gap-4">
            {
              imagesData.library
                .slice(1, 4)
                .map((img: string, index: number) => (
                  <div class="aspect-square rounded-xl overflow-hidden shadow-md">
                    <img
                      src={img}
                      alt={`Library ${index + 2}`}
                      class="w-full h-full object-cover"
                    />
                  </div>
                ))
            }
          </div>
        </div>

        <!-- Info -->
        <div>
          <div class="bg-white rounded-2xl shadow-lg p-8 mb-6">
            <div
              class="prose prose-lg max-w-none"
              set:html={getLocalizedValue(library.content, locale)}
            />
          </div>

          <!-- Quick Stats -->
          <div class="grid grid-cols-2 gap-4">
            <div class="bg-orange-100 p-6 rounded-xl text-center">
              <div class="text-3xl font-bold text-orange-600">12,000+</div>
              <div class="text-sm text-orange-700">
                {locale === "id" ? "Koleksi Buku" : "Book Collection"}
              </div>
            </div>
            <div class="bg-green-100 p-6 rounded-xl text-center">
              <div class="text-3xl font-bold text-green-600">100+</div>
              <div class="text-sm text-green-700">
                {locale === "id" ? "Kapasitas" : "Capacity"}
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Services -->
      <div class="mt-12 bg-white rounded-2xl shadow-lg p-8">
        <h2 class="text-xl font-bold text-gray-900 mb-6">
          {locale === "id" ? "Layanan Perpustakaan" : "Library Services"}
        </h2>
        <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-4">
          <div class="p-4 bg-gray-50 rounded-xl text-center">
            <Icon
              name="tabler:book"
              class="w-8 h-8 text-primary-600 mx-auto mb-2"
            />
            <div class="font-medium text-gray-900">
              {locale === "id" ? "Peminjaman Buku" : "Book Lending"}
            </div>
          </div>
          <div class="p-4 bg-gray-50 rounded-xl text-center">
            <Icon
              name="tabler:device-laptop"
              class="w-8 h-8 text-primary-600 mx-auto mb-2"
            />
            <div class="font-medium text-gray-900">
              {locale === "id" ? "E-Library" : "E-Library"}
            </div>
          </div>
          <div class="p-4 bg-gray-50 rounded-xl text-center">
            <Icon
              name="tabler:printer"
              class="w-8 h-8 text-primary-600 mx-auto mb-2"
            />
            <div class="font-medium text-gray-900">
              {locale === "id" ? "Fotokopi & Print" : "Photocopy & Print"}
            </div>
          </div>
          <div class="p-4 bg-gray-50 rounded-xl text-center">
            <Icon
              name="tabler:users"
              class="w-8 h-8 text-primary-600 mx-auto mb-2"
            />
            <div class="font-medium text-gray-900">
              {locale === "id" ? "Ruang Diskusi" : "Discussion Room"}
            </div>
          </div>
        </div>
      </div>

      <!-- Back Button -->
      <div class="mt-8 text-center">
        <a
          href={getLocalizedPath("/layanan", locale)}
          class="btn-outline"
          data-testid="back-to-services"
        >
          <Icon name="tabler:arrow-left" class="w-5 h-5 mr-2" />
          {t("common.back", locale)}
        </a>
      </div>
    </div>
  </section>
</Layout>
